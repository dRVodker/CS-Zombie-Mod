#include "cszm_modules/newspawn"
#include "cszm_modules/cashmaker"

array<array<CSpawnPoint@>> PrimarySpawns =
{
	{
		CSpawnPoint(Vector(-35, 268, -288), QAngle(0, 60, 0)),
		CSpawnPoint(Vector(109, 777, -288), QAngle(0, 300, 0)),
		CSpawnPoint(Vector(274, 787, -288), QAngle(0, 300, 0)),
		CSpawnPoint(Vector(477, 784, -288), QAngle(0, 285, 0)),
		CSpawnPoint(Vector(677, 36.6151, -247), QAngle(0, 150, 0)),
		CSpawnPoint(Vector(29, 163, -248), QAngle(0, 315, 0)),
		CSpawnPoint(Vector(8, 44, -248), QAngle(0, 30, 0)),
		CSpawnPoint(Vector(217, -414, -203), QAngle(0, 240, 0)),
		CSpawnPoint(Vector(226, -355, -225), QAngle(0, 120, 0)),
		CSpawnPoint(Vector(-127, -293, -190), QAngle(0, 330, 0)),
		CSpawnPoint(Vector(-119, -536, -181), QAngle(0, 30, 0)),
		CSpawnPoint(Vector(431, -606, -201), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(419, -391, -202), QAngle(0, 210, 0)),
		CSpawnPoint(Vector(484.309, -803, -174), QAngle(0, 120, 0)),
		CSpawnPoint(Vector(105, -769, -189), QAngle(0, 30, 0)),
		CSpawnPoint(Vector(617.499, -160, -273), QAngle(0, 240, 0)),
		CSpawnPoint(Vector(37, -262, -233), QAngle(0, 330, 0)),
		CSpawnPoint(Vector(659, -383, -281), QAngle(0, 150, 0)),
		CSpawnPoint(Vector(492, 264, -288), QAngle(0, 120, 0)),
		CSpawnPoint(Vector(1107, 548, -243), QAngle(0, 150, 0)),
		CSpawnPoint(Vector(-28, 454, -288), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(764, 567, -242), QAngle(0, 30, 0)),
		CSpawnPoint(Vector(977, 901, -247), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(541, -926, -391), QAngle(0, 45, 0)),

		CSpawnPoint(Vector(2024, -752, -478), QAngle(0, 90, 0), "info_player_start"),
		CSpawnPoint(Vector(3328, -272, -479), QAngle(0, 270, 0), "info_player_start"),
		CSpawnPoint(Vector(816, -1280, -399), QAngle(0, 0, 0), "info_player_start")
	},
	{
		CSpawnPoint(Vector(2204, 1200, -359.999), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(2115, 1003, -375.999), QAngle(0, 300, 0)),
		CSpawnPoint(Vector(1961, 1005, -375.999), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(1770, 825, -375.999), QAngle(0, 15, 0)),
		CSpawnPoint(Vector(2452, 1180, -375.999), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(2612, -722, -471.999), QAngle(0, 150, 0)),
		CSpawnPoint(Vector(3330, -392, -471.999), QAngle(0, 240, 0)),
		CSpawnPoint(Vector(3343, -776, -471.999), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(3106.26, -776.524, -471.999), QAngle(0, 60, 0)),
		CSpawnPoint(Vector(3612, -260, -471.999), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(3610, 106, -466), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(3074, 110, -471.999), QAngle(0, 315, 0)),
		CSpawnPoint(Vector(3023, -77, -471.999), QAngle(0, 15, 0)),
		CSpawnPoint(Vector(2887.05, -718.358, -471.999), QAngle(0, 45, 0)),
		CSpawnPoint(Vector(1464, 980, -375.999), QAngle(0, 345, 0)),
		CSpawnPoint(Vector(2449, 1613, -375.999), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(2248, 1531, -375.999), QAngle(0, 300, 0)),
		CSpawnPoint(Vector(2506, 865, -375.999), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(2486, 447, -375.999), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(1952, 545, -370), QAngle(0, 330, 0)),
		CSpawnPoint(Vector(1786, 415, -375.999), QAngle(0, 15, 0)),
		CSpawnPoint(Vector(2832, 615, -374.999), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(2988, 610, -374.999), QAngle(0, 30, 0)),
		CSpawnPoint(Vector(2944, -586, -471.999), QAngle(0, 195, 0)),

		CSpawnPoint(Vector(2024, -752, -478), QAngle(0, 90, 0), "info_player_start"),
		CSpawnPoint(Vector(3328, -272, -479), QAngle(0, 270, 0), "info_player_start"),
		CSpawnPoint(Vector(816, -1280, -399), QAngle(0, 0, 0), "info_player_start")
	},
	{
		CSpawnPoint(Vector(974.365, -1122, -393), QAngle(0, 180, 0)),
		CSpawnPoint(Vector(862, -1600, -392), QAngle(0, 60, 0)),
		CSpawnPoint(Vector(1234, -1471, -390), QAngle(0, 345, 0)),
		CSpawnPoint(Vector(2149, -1599, -377), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(1496, -1406, -467), QAngle(0, 330, 0)),
		CSpawnPoint(Vector(1836, -1224.08, -468), QAngle(0, 210, 0)),
		CSpawnPoint(Vector(1529, -1228.02, -471), QAngle(0, 315, 0)),
		CSpawnPoint(Vector(2109, -993, -471), QAngle(0, 120, 0)),
		CSpawnPoint(Vector(1902.11, -884, -468), QAngle(0, 345, 0)),
		CSpawnPoint(Vector(1816, -573, -456), QAngle(0, 315, 0)),
		CSpawnPoint(Vector(1738, -588, -456), QAngle(0, 195, 0)),
		CSpawnPoint(Vector(1461, -819, -281), QAngle(0, 330, 0)),
		CSpawnPoint(Vector(1736, -1300, -281), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(1333, -1303, -281), QAngle(0, 60, 0)),
		CSpawnPoint(Vector(1041, -1093, -274), QAngle(0, 60, 0)),
		CSpawnPoint(Vector(1109, -693, -239), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(1796, -1109, -281), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(2407, -464, -279), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(2227, -227, -281), QAngle(0, 270, 0)),
		CSpawnPoint(Vector(1592, -475, -279), QAngle(0, 330, 0)),
		CSpawnPoint(Vector(1711, -337, -407), QAngle(0, 30, 0)),
		CSpawnPoint(Vector(2241, -325, -407), QAngle(0, 135, 0)),
		CSpawnPoint(Vector(2219, 163, -343.999), QAngle(0, 225, 0)),
		CSpawnPoint(Vector(1718, 156, -343.999), QAngle(0, 330, 0)),

		CSpawnPoint(Vector(2024, -752, -478), QAngle(0, 90, 0), "info_player_start"),
		CSpawnPoint(Vector(3328, -272, -479), QAngle(0, 270, 0), "info_player_start"),
		CSpawnPoint(Vector(816, -1280, -399), QAngle(0, 0, 0), "info_player_start")
	}
};

array<array<CSpawnPoint@>> SecondarySpawns =
{
	{
		CSpawnPoint(Vector(1115, 546, -248), QAngle(0, 165, 0)),
		CSpawnPoint(Vector(-5, 259, -287), QAngle(0, 45, 0)),
		CSpawnPoint(Vector(1781, 414, -376), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(2524, 1015, -376), QAngle(0, 210, 0)),
		CSpawnPoint(Vector(29, 163, -248), QAngle(0, 315, 0)),
		CSpawnPoint(Vector(547, -927, -391), QAngle(0, 45, 0)),
		CSpawnPoint(Vector(2146, -989, -472), QAngle(0, 180, 0)),
		CSpawnPoint(Vector(3319, -403, -472), QAngle(0, 210, 0))
	}
};

void OnMapInit()
{
	CashDATA();
	OnNewRound();
}

void OnNewRound()
{
	Schedule::Task(0.05f, "SetUpStuff");
}

void SetUpStuff()
{
	//RemoveNativeSpawns("info_player_human");
	//RemoveNativeSpawns("info_player_zombie");
	RemoveNativeSpawns("info_player_start");
	CreateSpawnsFromArray(PrimarySpawns, true);

	Engine.Ent_Fire("tonemap", "SetAutoExposureMax", "1.05", "0");
	Engine.Ent_Fire("tonemap", "SetAutoExposureMin", "0.45", "0");
	Engine.Ent_Fire("tonemap", "SetBloomScale", "0.7", "0");

	ColorCorrection();
	ShadowControl();
	KillSprite();
}

void ShadowControl()
{
	CBaseEntity@ pShadow = FindEntityByClassname(null, "shadow_control");
	if (pShadow !is null)
	{
		Engine.Ent_Fire_Ent(pShadow, "Disable", "0", "0.00");
		Engine.Ent_Fire_Ent(pShadow, "AddOutput", "color 221 221 221", "0.05");
		Engine.Ent_Fire_Ent(pShadow, "AddOutput", "distance 32.5", "0.05");
		Engine.Ent_Fire_Ent(pShadow, "Enable", "0", "0.1");
	}
}

void ColorCorrection()
{
	CBaseEntity@ pColor = FindEntityByClassname(null, "color_correction");
	if (pColor !is null)
	{
		Engine.Ent_Fire_Ent(pColor, "Disable", "0", "0.00");
		Engine.Ent_Fire_Ent(pColor, "AddOutput", "maxweight 0.65", "0.05");
		Engine.Ent_Fire_Ent(pColor, "AddOutput", "fadeInDuration 0.01", "0.05");
		Engine.Ent_Fire_Ent(pColor, "AddOutput", "fadeOutDuration 0.01", "0.05");
		Engine.Ent_Fire_Ent(pColor, "Enable", "0", "0.1");
	}
}

void KillSprite()
{
	CBaseEntity@ pSprite = null;
	while ((@pSprite = FindEntityByClassname(pSprite, "env_sprite")) !is null)
	{
		if (pSprite.GetAbsOrigin() == Vector(7379, -376, 290))
		{
			pSprite.SetEntityName("bad_sprite");
			Engine.Ent_Fire("bad_sprite", "hidesprite", "0", "0.1");
			break;
		}
	}
}

void OnMatchBegin()
{
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(SecondarySpawns, false);
}

void CashDATA()
{
	MaxRandomCash = 40;
	MinRandomCash = 18;

	MaxMoneyPerItem = 80.0f;
	MinMoneyPerItem = 20.0f;

	InsertToArray(1704.43, -196.481, -413.75);
	InsertToArray(1714.08, 170.721, -349.75);
	InsertToArray(2249.77, 161.819, -246.012);
	InsertToArray(1969.42, -116.045, -113.75);
	InsertToArray(1962.35, 2.63379, -413.75);
	InsertToArray(1915.99, 58.0125, -413.75);
	InsertToArray(2246.25, -179.995, -216.033);
	InsertToArray(2281.04, -241.121, -182.012);
	InsertToArray(708.525, -398, -281);
	InsertToArray(883.31, -1611.48, -397.75);
	InsertToArray(1229.73, -1597, -395);
	InsertToArray(2158.22, -1571, -246);
	InsertToArray(1509.02, -1267.87, -419.072);
	InsertToArray(1491.31, -1295.5, -361.482);
	InsertToArray(1520.78, -1175.4, -374.012);
	InsertToArray(1676.68, -1172.65, -374.012);
	InsertToArray(1876.65, -1228.24, -477.75);
	InsertToArray(1799.41, -810.103, -485.75);
	InsertToArray(1556.36, -927.132, -397.234);
	InsertToArray(1570.01, -1097.32, -454.75);
	InsertToArray(1814.69, -1069.14, -485.75);
	InsertToArray(1574.91, -1597.9, -254);
	InsertToArray(2169.63, -1466.39, -380.61);
	InsertToArray(3341, -177, -447);
	InsertToArray(3101.15, -447.448, -477.75);
	InsertToArray(2757.22, -721.157, -372.75);
	InsertToArray(2546.09, -694.828, -329.75);
	InsertToArray(1875.51, -973.126, -418.684);
	InsertToArray(2164.07, -971.668, -477.75);
	InsertToArray(1587.55, -428.174, -195.234);
	InsertToArray(1536.73, -917.419, -285.75);
	InsertToArray(1774.4, -810, -181);
	InsertToArray(1775.82, -865.459, -182.012);
	InsertToArray(1742.6, -775, -181);
	InsertToArray(1666.91, -946.228, -333.75);
	InsertToArray(1824, -1149.1, -182);
	InsertToArray(1388.21, -630.443, -141.75);
	InsertToArray(1379, -1199, -143.649);
	InsertToArray(1294.53, -1310.82, -232.198);
	InsertToArray(439, -450, -45);
	InsertToArray(450.182, -336.528, -165.75);
	InsertToArray(480.681, -350.9, -205.75);
	InsertToArray(356, -372, -179);
	InsertToArray(463, -576, -158.721);
	InsertToArray(465, -575, -195.851);
	InsertToArray(68, -623, -189.15);
	InsertToArray(106, -656, -185);
	InsertToArray(-75.8748, -238.548, -165.75);
	InsertToArray(-34.543, 16.2731, -253.75);
	InsertToArray(393.751, 18.569, -163.234);
	InsertToArray(531.157, 364.495, -293.75);
	InsertToArray(680.819, 756.444, -293.75);
	InsertToArray(329.951, 848.313, -293.75);
	InsertToArray(-61.5493, 840.646, -293.75);
	InsertToArray(98.1201, 247.097, -293.75);
	InsertToArray(784.544, 645.519, -253.75);
	InsertToArray(1130.74, 662.085, -253.75);
	InsertToArray(1061.13, 510.853, -163.234);
	InsertToArray(1480.45, 841.284, -381.75);
	InsertToArray(2264, 1065, -381.75);
	InsertToArray(2380.41, 418.322, -381.75);
	InsertToArray(2937.35, 613.485, -314.266);
	InsertToArray(2566.74, 403.173, -302.336);
	InsertToArray(1848.31, 383.961, -381.75);
	InsertToArray(1893.9, 618.953, -380.75);
	InsertToArray(1775, 1028.15, -381.75);
	InsertToArray(1947.06, 726.282, -190.72);
	InsertToArray(2563.15, 960.766, -290.364);
	InsertToArray(2455.8, 1237.23, -344.546);
	InsertToArray(2497.29, 1512.85, -381.75);
	InsertToArray(2242.15, 1604.24, -320.123);
	InsertToArray(2237, 1738, -381.75);
	InsertToArray(2479, 1716, -381.75);
	InsertToArray(2491.1, 2123.23, -247.75);
	InsertToArray(2217, 2161, -247.75);
	InsertToArray(2022.49, 413.619, -381.75);
	InsertToArray(854.897, -947.256, -451.75);
	InsertToArray(937.647, -853.516, -396.75);
	InsertToArray(3612.4, -145.988, -469.421);
	InsertToArray(3586.57, -89.8341, -426.785);
	InsertToArray(3607, 37.8369, -478.281);
	InsertToArray(2386.12, -504.485, -143.75);
	InsertToArray(2155.65, -763.886, -426.964);
}