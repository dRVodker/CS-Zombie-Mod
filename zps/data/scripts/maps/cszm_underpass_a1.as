#include "cszm_modules/spawncrates"
#include "cszm_modules/newspawn"

array<array<CSpawnPoint@>> New_Spawns = 
{
	{
		CSpawnPoint(Vector(533.737, -1276.45, 0.03125), QAngle(0, -142.32, 0)),
		CSpawnPoint(Vector(493.954, -1385.69, 0.03125), QAngle(0, 170.058, 0)),
		CSpawnPoint(Vector(401.277, -1227.77, 7.76096), QAngle(0, -58.8088, 0)),
		CSpawnPoint(Vector(427.558, -1454.53, 2.51342), QAngle(0, 87.8607, 0)),
		CSpawnPoint(Vector(554.88, -1639.78, 0.03125), QAngle(-0.2904, 160.797, 0)),
		CSpawnPoint(Vector(447.794, -1540.4, 0.03125), QAngle(3.3033, -165.444, 0)),
		CSpawnPoint(Vector(443.623, -1625.48, 0.03125), QAngle(2.17799, 172.74, 0)),
		CSpawnPoint(Vector(345.953, -1512.49, 0.03125), QAngle(1.37939, -164.826, 0)),
		CSpawnPoint(Vector(342.955, -1593.75, 0.03125), QAngle(0.108866, 178.149, 0)),
		CSpawnPoint(Vector(377.223, -1702.98, 0.03125), QAngle(0.181462, -156.066, 0)),
		CSpawnPoint(Vector(304.55, -1701, 0.03125), QAngle(-1.19794, 178.911, 0)),
		CSpawnPoint(Vector(233.846, -1599.54, 0.03125), QAngle(1.37936, 172.958, 0)),
		CSpawnPoint(Vector(288.168, -1524.9, 0.03125), QAngle(1.88757, -148.6, 0)),
		CSpawnPoint(Vector(197.788, -1517.49, 0.03125), QAngle(1.88757, -172.014, 0)),
		CSpawnPoint(Vector(127.382, -1582.37, 0.03125), QAngle(5.26347, 176.878, 0)),
		CSpawnPoint(Vector(50.7339, -1544.89, 0.03125), QAngle(4.31966, 179.964, 0)),
		CSpawnPoint(Vector(-21.4264, -1536.04, 0.03125), QAngle(4.79156, 176.806, 0)),
		CSpawnPoint(Vector(-57.2075, -1845.54, 8.03125), QAngle(8.20376, 52.9011, 0)),
		CSpawnPoint(Vector(219.528, -1703.92, 0.03125), QAngle(1.01634, -179.432, 0)),
		CSpawnPoint(Vector(146.057, -1644.54, 0.03125), QAngle(1.37934, 176.975, 0)),
		CSpawnPoint(Vector(133.736, -1702.69, 0.03125), QAngle(7.58664, 177.882, 0)),
		CSpawnPoint(Vector(31.37, -1701.19, 0.03125), QAngle(5.91684, 179.189, 0)),
		CSpawnPoint(Vector(-0.165436, -1606.91, 0.03125), QAngle(3.26693, -179.976, 0)),
		CSpawnPoint(Vector(83.2054, -1629.74, 0.03125), QAngle(-0.0726671, -166.509, 0)),
		CSpawnPoint(Vector(-56.6387, -1697.77, 0.03125), QAngle(-1.45209, 172.546, 0))
	},
	{
		CSpawnPoint(Vector(-671.151, -2563.97, -431.969), QAngle(2.72234, 76.5554, 0)),
		CSpawnPoint(Vector(-658.213, -2462.9, -431.969), QAngle(0.979939, 92.7089, 0)),
		CSpawnPoint(Vector(-659.918, -2378.22, -431.969), QAngle(3.99284, 83.1257, 0)),
		CSpawnPoint(Vector(-690.856, -2251.14, -431.969), QAngle(0.762139, -55.5041, 0)),
		CSpawnPoint(Vector(-511.314, -2243.64, -431.969), QAngle(2.50454, -123.349, 0)),
		CSpawnPoint(Vector(-573.335, -2383.16, -431.969), QAngle(9.11112, 101.397, 0)),
		CSpawnPoint(Vector(-562.473, -2537.2, -431.969), QAngle(4.02909, 86.6232, 0)),
		CSpawnPoint(Vector(-456.903, -2511.59, -431.969), QAngle(4.79139, 83.1021, 0)),
		CSpawnPoint(Vector(-486.597, -2445.23, -431.969), QAngle(8.16729, 110.255, 0)),
		CSpawnPoint(Vector(-390.316, -2616.8, -431.969), QAngle(3.5935, 90.0354, 0)),
		CSpawnPoint(Vector(-377.949, -2516.87, -431.969), QAngle(3.04899, 90.0717, 0)),
		CSpawnPoint(Vector(-104.434, -2617.11, -431.969), QAngle(4.28319, 89.6725, 0)),
		CSpawnPoint(Vector(-240.465, -2621.68, -431.969), QAngle(3.4846, 94.0648, 0)),
		CSpawnPoint(Vector(-309.135, -2570.81, -431.969), QAngle(4.64619, 94.7907, 0)),
		CSpawnPoint(Vector(-307.401, -2471.13, -431.969), QAngle(4.75509, 89.4183, 0)),
		CSpawnPoint(Vector(-228.88, -2352.1, -431.969), QAngle(2.6134, 97.0776, 0)),
		CSpawnPoint(Vector(-110.976, -2443.1, -431.969), QAngle(4.53731, 93.9557, 0)),
		CSpawnPoint(Vector(-115.895, -2277.15, -431.969), QAngle(2.10521, -95.6521, 0)),
		CSpawnPoint(Vector(-160.678, -2145.46, -431.969), QAngle(3.66611, -90.6064, 0)),
		CSpawnPoint(Vector(-330.199, -2227.61, -431.969), QAngle(5.55369, -88.1381, 0)),
		CSpawnPoint(Vector(-324.782, -2124.11, -431.969), QAngle(4.9366, -85.6333, 0)),
		CSpawnPoint(Vector(-403.396, -2447.82, -431.969), QAngle(2.17785, 94.8996, 0)),
		CSpawnPoint(Vector(-335.621, -2360.1, -431.969), QAngle(4.68252, 1.64482, 0)),
		CSpawnPoint(Vector(-115.757, -2350.07, -431.969), QAngle(2.06893, 178.716, 0)),
		CSpawnPoint(Vector(-710.596, -2146.8, -515.969), QAngle(0.97993, 51.158, 0)),
		CSpawnPoint(Vector(-552.688, -2091.8, -515.969), QAngle(2.21412, 179.6, 0))
	},
	{
		CSpawnPoint(Vector(-103.837, -2612.44, -431.969), QAngle(-0.472083, 135.156, 0)),
		CSpawnPoint(Vector(-851.195, -2245.04, -431.969), QAngle(-0.50838, -36.7969, 0)),
		CSpawnPoint(Vector(-234.734, -1539.48, -431.969), QAngle(0.798454, -81.1684, 0)),
		CSpawnPoint(Vector(528.247, -1209.01, -363.969), QAngle(8.89335, 147.34, 0)),
		CSpawnPoint(Vector(379.319, -765.853, -363.969), QAngle(3.5572, -95.883, 0)),
		CSpawnPoint(Vector(-9.73924, -1428.88, 0.03125), QAngle(2.5408, 29.3156, 0)),
		CSpawnPoint(Vector(999.121, -1271.62, 159.44), QAngle(10.672, -151.036, 0)),
		CSpawnPoint(Vector(-42.5394, -1324.87, 181.908), QAngle(17.206, 141.41, 0)),
		CSpawnPoint(Vector(336.969, -410.249, 320.031), QAngle(2.17782, -132.051, 0)),
		CSpawnPoint(Vector(-210.612, -60.1341, 0.03125), QAngle(0.97993, -101.885, 0)),
		CSpawnPoint(Vector(-358.508, -856.836, -139.969), QAngle(3.81133, -42.7163, 0)),
		CSpawnPoint(Vector(-674.554, -839.735, -493.969), QAngle(4.97298, -65.5854, 0)),
		CSpawnPoint(Vector(-1208.89, -1398.85, -535.969), QAngle(-1.45212, 4.12333, 0)),
		CSpawnPoint(Vector(-1075.39, -497.404, -399.969), QAngle(2.54088, -134.447, 0)),
		CSpawnPoint(Vector(-969.971, -1033.61, 0.03125), QAngle(14.7014, 40.3742, 0)),
		CSpawnPoint(Vector(-934.106, -327.967, 8.03125), QAngle(1.9238, -142.179, 0)),
		CSpawnPoint(Vector(-264.189, -2311.49, 0.03125), QAngle(0.834789, 98.3092, 0)),
		CSpawnPoint(Vector(-716.679, -1590.04, 0.03125), QAngle(1.8875, -94.5656, 0)),
		CSpawnPoint(Vector(-1116.43, -1838.04, -47.9688), QAngle(14.9192, -57.4669, 0)),
		CSpawnPoint(Vector(-203.379, -2036.05, -307.969), QAngle(19.3841, -77.3594, 0)),
		CSpawnPoint(Vector(-141.061, -1281.5, -339.048), QAngle(10.9625, -107.392, 0)),
		CSpawnPoint(Vector(16.0587, -1850.45, 8.03125), QAngle(0.87111, 49.0476, 0)),
		CSpawnPoint(Vector(59.2885, -1367.53, 322.031), QAngle(17.7506, 126.452, 0)),
		CSpawnPoint(Vector(-275.052, -1727.14, 322.031), QAngle(5.80792, 111.279, 0))
	}
};

int iMaxPlayers;

void OnMapInit()
{
	iMaxPlayers = Globals.GetMaxClients();
	Schedule::Task(0.05f, "SetUpStuff");

	iMinCrates = 0;
	iMaxCrates = 4;

	//Spawn points for "prop_itemcrate"
	g_PICOrigin.insertLast(Vector(216.58, -1251.65, 25));
	g_PICAngles.insertLast(QAngle(0, 335, 0));
	
	g_PICOrigin.insertLast(Vector(-358, -1725.47, -428.97));
	g_PICAngles.insertLast(QAngle(0, 334.5, 0));
	
	g_PICOrigin.insertLast(Vector(-1529.76, -2106.13, -46));
	g_PICAngles.insertLast(QAngle(0, 336, 0));
	
	g_PICOrigin.insertLast(Vector(-884.28, -2330.05, -45));
	g_PICAngles.insertLast(QAngle(0, 315, 0));
	
	g_PICOrigin.insertLast(Vector(-971.61, -1969.15, -31.99));
	g_PICAngles.insertLast(QAngle(-87.95, 295.724, -14.0065));
	
	g_PICOrigin.insertLast(Vector(-261.09, -1809.13, 359.26));
	g_PICAngles.insertLast(QAngle(0, 314.5, 0));
	
	g_PICOrigin.insertLast(Vector(358.05, -384.85, 323));
	g_PICAngles.insertLast(QAngle(0, 136, 0));
	
	g_PICOrigin.insertLast(Vector(-608.12, -770.22, -330.15));
	g_PICAngles.insertLast(QAngle(0, 0, 90));
	
	g_PICOrigin.insertLast(Vector(-1150.88, -502.75, -392));
	g_PICAngles.insertLast(QAngle(0, 26, 0));
	
	g_PICOrigin.insertLast(Vector(-1037.5, -523.18, 86.58));
	g_PICAngles.insertLast(QAngle(0, 0, 0));
	
	g_PICOrigin.insertLast(Vector(556.78, -1107.16, -271.35));
	g_PICAngles.insertLast(QAngle(-28, 0, 0));
	
	g_PICOrigin.insertLast(Vector(-109.28, -1257.29, -305.83));
	g_PICAngles.insertLast(QAngle(-54.3743, 22.5675, 1.09255));
	
	g_PICOrigin.insertLast(Vector(-67.9, -1436.44, 173.59));
	g_PICAngles.insertLast(QAngle(-14, 0, 0));
}

void OnNewRound()
{	
	Schedule::Task(0.05f, "SetUpStuff");
}

void OnMatchBegin() 
{
	Schedule::Task(0.5f, "SpawnCrates");
}

void SetUpStuff()
{
	Engine.Ent_Fire("screenoverlay", "StartOverlays");
	Engine.Ent_Fire("ventprop_junk", "DisableMotion");
	Engine.Ent_Fire("ventprop_junk", "DamageToEnableMotion 10");
	CreatedByColors();

	RemoveNativeSpawns("info_player_zombie");
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(New_Spawns);
}

void CreatedByColors()
{
	float flFireTime = Math::RandomFloat(0.10f, 1.20f);
	
	Schedule::Task(flFireTime, "CreatedByColors");
	
	int iR = Math::RandomInt(32, 255);
	int iG = Math::RandomInt(32, 255);
	int iB = Math::RandomInt(32, 255);
	
	Engine.Ent_Fire("created_by", "color", ""+iR+" "+iG+" "+iB);
}