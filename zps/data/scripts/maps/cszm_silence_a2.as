#include "cszm_modules/lobbyambient"
#include "cszm_modules/newspawn"

array<array<CSpawnPoint@>> New_Spawns = 
{
	{
		CSpawnPoint(Vector(32, -208, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-56, 48, -250.43), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-8, 96, -250.43), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-12, 284, -250.43), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(0, -400, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(0, 656, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(72, 200, -253.08), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(0, -272, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(32, 592, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-56, 232, -253.467), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-60, 348, -250.75), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-64, -336, -255.188), QAngle(0, -0.261528, 0)),
		CSpawnPoint(Vector(-64, -208, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(16, 160, -253.08), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(40, 48, -254.75), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(0, 784, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(80, 96, -254.43), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-64, 848, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(32, 344, -255.408), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(8, 224, -253.467), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(32, -464, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(32, -336, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(32, 848, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-64, -464, -255.188), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-56, 156, -253.467), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-64, 720, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(-64, 592, -254.229), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(80, 284, -254.75), QAngle(0, 0, 0)),
		CSpawnPoint(Vector(32, 720, -254.229), QAngle(0, 0, 0))
	},
	{
		CSpawnPoint(Vector(-42.8879, 285.981, -254.969), QAngle(-4.79156, -12.5603, 0)),
		CSpawnPoint(Vector(132.226, 12.1632, -255.969), QAngle(-6.71546, 36.7351, 0)),
		CSpawnPoint(Vector(79.3522, 1045.69, -255.969), QAngle(2.72254, -93.2189, 0)),
		CSpawnPoint(Vector(647.413, 1015.6, -236.537), QAngle(20.1828, 28.3135, 0)),
		CSpawnPoint(Vector(879.178, 861.99, -223.969), QAngle(10.2366, -78.6392, 0)),
		CSpawnPoint(Vector(602.432, -80.1027, -223.969), QAngle(3.41219, 166.556, 0)),
		CSpawnPoint(Vector(1072.03, 620.386, -223.969), QAngle(2.64988, -30.7469, 0)),
		CSpawnPoint(Vector(1824.54, 554.357, -255.969), QAngle(1.63349, -120.312, 0)),
		CSpawnPoint(Vector(1149.15, -783.037, -255.98), QAngle(0.254097, 14.0472, 0)),
		CSpawnPoint(Vector(4.70648, -780.065, -255.969), QAngle(0.471898, 54.7759, 0)),
		CSpawnPoint(Vector(298.321, -194.509, -223.969), QAngle(1.70609, -48.2196, 0)),
		CSpawnPoint(Vector(1050.38, -494.013, -47.9688), QAngle(4.46487, 160.699, 0)),
		CSpawnPoint(Vector(1603.53, -483.677, -47.9688), QAngle(4.39226, 136.088, 0)),
		CSpawnPoint(Vector(573.961, 660.151, -47.9688), QAngle(7.91335, -95.3744, 0)),
		CSpawnPoint(Vector(1614.32, 699.146, -47.9688), QAngle(12.1968, 125.91, 0)),
		CSpawnPoint(Vector(736.331, 397.35, -45.9688), QAngle(2.50465, 48.1197, 0)),
		CSpawnPoint(Vector(1734.33, 35.1199, -575.969), QAngle(-5.88065, 81.6972, 0)),
		CSpawnPoint(Vector(1941.78, 1099.21, -575.969), QAngle(1.63345, -148.567, 0)),
		CSpawnPoint(Vector(742.969, 899.031, -766.969), QAngle(-27.5155, 122.486, 0)),
		CSpawnPoint(Vector(1412.07, 946.496, -766.969), QAngle(14.0117, 62.8448, 0)),
		CSpawnPoint(Vector(636.607, -168.773, -575.969), QAngle(8.78449, -131.251, 0)),
		CSpawnPoint(Vector(939.945, 634.771, -639.969), QAngle(3.37579, -22.8466, 0)),
		CSpawnPoint(Vector(1267.5, -101.941, -218.834), QAngle(13.0316, -32.746, 0)),
		CSpawnPoint(Vector(740.837, 1658.23, -574.969), QAngle(20.2916, -125.324, 0))
	},
	{
		CSpawnPoint(Vector(449.074, 283.341, -47.9688), QAngle(0, -23.158, 0)),
		CSpawnPoint(Vector(520.92, 91.7454, -47.9688), QAngle(0, 24.5082, 0)),
		CSpawnPoint(Vector(639.6, 278.578, -47.9688), QAngle(22.2519, -151.2, 0)),
		CSpawnPoint(Vector(639.995, 123.231, -47.9688), QAngle(22.869, 153.878, 0)),
		CSpawnPoint(Vector(763.898, 88.4035, -47.9688), QAngle(2.68622, 31.9102, 0)),
		CSpawnPoint(Vector(881.598, 289.975, -47.9688), QAngle(3.08552, -123.612, 0)),
		CSpawnPoint(Vector(1144.93, 69.5962, -47.9688), QAngle(17.5329, 102.441, 0)),
		CSpawnPoint(Vector(944.031, 319.969, -47.9688), QAngle(18.15, -53.4077, 0)),
		CSpawnPoint(Vector(1154.48, 306.547, -47.9688), QAngle(14.4474, -142.996, 0)),
		CSpawnPoint(Vector(1373.92, 430.613, -47.9688), QAngle(3.33962, 128.686, 0)),
		CSpawnPoint(Vector(1601.81, 833.836, -47.9688), QAngle(14.9193, -132.941, 0)),
		CSpawnPoint(Vector(1143.59, 635.323, -47.9688), QAngle(18.5857, -170.657, 0)),
		CSpawnPoint(Vector(1088.39, 976.13, -47.9688), QAngle(4.42864, -150.159, 0)),
		CSpawnPoint(Vector(850.41, 970.799, -47.9688), QAngle(2.86774, -49.56, 0)),
		CSpawnPoint(Vector(930.168, 803.843, -47.9688), QAngle(2.43206, 73.122, 0)),
		CSpawnPoint(Vector(203.959, 587.989, -47.9688), QAngle(10.164, 50.0113, 0)),
		CSpawnPoint(Vector(209.13, 811.99, -47.9688), QAngle(15.5727, -51.7013, 0)),
		CSpawnPoint(Vector(479.3, 839.74, -47.9688), QAngle(6.53395, -120.635, 0)),
		CSpawnPoint(Vector(391.667, 591.713, -47.9688), QAngle(6.53396, 95.4228, 0)),
		CSpawnPoint(Vector(592.689, 427.687, -47.9688), QAngle(9.29276, 141.464, 0)),
		CSpawnPoint(Vector(203.965, -435.192, -47.9688), QAngle(9.54684, 62.5841, 0)),
		CSpawnPoint(Vector(501.084, -171.902, -47.9688), QAngle(13.5761, -38.851, 0)),
		CSpawnPoint(Vector(771.44, -469.705, -47.9688), QAngle(7.11472, 53.8592, 0)),
		CSpawnPoint(Vector(985.939, -109.084, -47.9688), QAngle(11.9063, -114.065, 0)),
		CSpawnPoint(Vector(993.755, -322.335, -47.9688), QAngle(14.1569, 153.733, 0)),
		CSpawnPoint(Vector(1388.35, -591.382, -47.9688), QAngle(8.34891, 137.193, 0)),
		CSpawnPoint(Vector(1140.54, -610.241, -47.9688), QAngle(7.69551, 46.3345, 0)),
		CSpawnPoint(Vector(1600.91, -165.763, -47.9688), QAngle(4.24702, 127.089, 0))
	}
};

array<array<CSpawnPoint@>> New_ZombieSpawns = 
{
	{
		CSpawnPoint(Vector(1934.9, 1120.73, -575.969), QAngle(3.41012, -140.395, 0)),
		CSpawnPoint(Vector(1482.93, 942.283, -575.969), QAngle(6.82231, 18.7205, 0)),
		CSpawnPoint(Vector(2096.43, 966.257, -575.969), QAngle(3.41011, -83.8269, 0)),
		CSpawnPoint(Vector(1466.59, 1384.72, -575.969), QAngle(0.578725, -146.118, 0)),
		CSpawnPoint(Vector(1763.72, 1373.75, -675.969), QAngle(-11.9447, -146.771, 0)),
		CSpawnPoint(Vector(1745.58, 1211.14, -767.969), QAngle(2.03073, 164.429, 0)),
		CSpawnPoint(Vector(1490.15, 985.579, -766.969), QAngle(1.12324, 111.758, 0)),
		CSpawnPoint(Vector(904.19, 1631.02, -766.969), QAngle(-1.01846, -141.23, 0)),
		CSpawnPoint(Vector(620.423, 954.887, -766.969), QAngle(1.41362, 65.1851, 0)),
		CSpawnPoint(Vector(159.495, 1359.84, -767.969), QAngle(6.20521, -26.1218, 0)),
		CSpawnPoint(Vector(177.927, 1189.2, -675.969), QAngle(-14.5947, 53.7147, 0)),
		CSpawnPoint(Vector(426.578, 1345.41, -575.969), QAngle(4.4628, -29.2671, 0)),
		CSpawnPoint(Vector(727.716, 1632.25, -574.969), QAngle(1.8855, -111.886, 0)),
		CSpawnPoint(Vector(1126.1, 1607.68, -574.969), QAngle(0.941688, -89.8881, 0)),
		CSpawnPoint(Vector(590.459, 503.403, -575.969), QAngle(7.54832, 133.697, 0)),
		CSpawnPoint(Vector(46.2179, 488.209, -575.969), QAngle(6.96751, 37.2113, 0)),
		CSpawnPoint(Vector(604.354, 792.246, -511.969), QAngle(19.0191, -133.217, 0)),
		CSpawnPoint(Vector(1000.64, 738.433, -637.969), QAngle(-0.76444, -59.5645, 0)),
		CSpawnPoint(Vector(1391.83, 693.516, -639.969), QAngle(6.24146, -162.729, 0)),
		CSpawnPoint(Vector(1465.47, 442.19, -639.969), QAngle(0.687564, -178.919, 0)),
		CSpawnPoint(Vector(1003.85, 318.039, -639.969), QAngle(3.37376, 65.1751, 0)),
		CSpawnPoint(Vector(1126.11, 546.831, -587.969), QAngle(17.7123, -177.431, 0)),
		CSpawnPoint(Vector(194.583, 83.2964, -575.969), QAngle(1.341, 56.8014, 0)),
		CSpawnPoint(Vector(720.764, -461.94, -575.969), QAngle(7.0038, 132.317, 0)),
		CSpawnPoint(Vector(751.969, -204.541, -575.969), QAngle(2.06701, -176.427, 0)),
		CSpawnPoint(Vector(751.969, -312.153, -575.969), QAngle(-1.38146, -164.376, 0)),
		CSpawnPoint(Vector(575.178, -495.969, -575.969), QAngle(4.46284, 100.229, 0)),
		CSpawnPoint(Vector(527.936, -216.261, -575.969), QAngle(8.16545, 103.279, 0)),
		CSpawnPoint(Vector(1055.97, 103.996, -575.969), QAngle(0.324655, -129.187, 0)),
		CSpawnPoint(Vector(976.031, -623.969, -399.969), QAngle(-4.68474, 43.4193, 0)),
		CSpawnPoint(Vector(1503.97, -623.969, -223.969), QAngle(11.0332, 128.906, 0)),
		CSpawnPoint(Vector(1301.42, -38.7565, -223.969), QAngle(6.20524, -57.7123, 0)),
		CSpawnPoint(Vector(1599.38, -472.424, -223.969), QAngle(5.76963, 120.267, 0)),
		CSpawnPoint(Vector(1578.63, -576.269, -255.969), QAngle(6.38673, -30.0516, 0)),
		CSpawnPoint(Vector(1178.29, -762.158, -255.969), QAngle(-11.4003, 155.018, 0)),
		CSpawnPoint(Vector(1805.19, 513.989, -255.969), QAngle(1.15952, -131.801, 0)),
		CSpawnPoint(Vector(1833.4, 110.993, -255.969), QAngle(1.99442, 129.39, 0)),
		CSpawnPoint(Vector(1589.5, 412.312, -255.969), QAngle(-4.75738, 145.345, 0)),
		CSpawnPoint(Vector(1448.02, 264.585, -255.969), QAngle(3.80941, 63.2157, 0)),
		CSpawnPoint(Vector(1791.97, 815.969, -399.969), QAngle(1.44994, -141.226, 0)),
		CSpawnPoint(Vector(1791.54, -39.9688, -575.969), QAngle(2.2122, 127.081, 0)),
		CSpawnPoint(Vector(1323.08, -26.6891, -575.969), QAngle(4.93471, 52.5206, 0)),
		CSpawnPoint(Vector(2216.03, 214.982, -573.969), QAngle(7.94761, 134.196, 0)),
		CSpawnPoint(Vector(1944.03, 410.272, -575.969), QAngle(5.4429, -1.784, 0)),
		CSpawnPoint(Vector(2260.13, 631.674, -575.969), QAngle(5.37031, -149.561, 0)),
		CSpawnPoint(Vector(1969.6, 715.823, -511.969), QAngle(29.7639, -45.7067, 0)),
		CSpawnPoint(Vector(2087.57, 474.044, -575.969), QAngle(10.1982, -87.7058, -0)),
		CSpawnPoint(Vector(2133.44, -0.134772, -575.969), QAngle(5.11622, 159.401, 0)),
		CSpawnPoint(Vector(1631.97, 879.969, -223.969), QAngle(5.33401, -143.281, 0)),
		CSpawnPoint(Vector(1631.97, 672.031, -223.969), QAngle(1.88552, 164.774, 0)),
		CSpawnPoint(Vector(1135.71, 991.969, -223.969), QAngle(-1.09105, -162.448, 0)),
		CSpawnPoint(Vector(942.722, 907.918, -223.969), QAngle(14.6269, -119.941, 0)),
		CSpawnPoint(Vector(800.031, 672.031, -223.969), QAngle(9.29076, 84.6591, 0)),
		CSpawnPoint(Vector(751.969, 879.969, -223.969), QAngle(0.723959, -148.509, 0)),
		CSpawnPoint(Vector(211.615, 569.285, -214.969), QAngle(10.1983, 78.4031, 0)),
		CSpawnPoint(Vector(189.978, 798.999, -223.969), QAngle(16.0063, -21.4822, 0)),
		CSpawnPoint(Vector(707.193, 413.165, -223.969), QAngle(10.3435, 132.297, 0)),
		CSpawnPoint(Vector(552.954, 715.948, -223.969), QAngle(3.91839, -82.9312, 0)),
		CSpawnPoint(Vector(715.309, 946.928, -255.969), QAngle(1.84931, 153.483, 0)),
		CSpawnPoint(Vector(646.863, 1177.97, -253.969), QAngle(-1.49029, -145.374, -0)),
		CSpawnPoint(Vector(-111.888, 1147.84, -255.969), QAngle(-0.110886, -61.6935, 0)),
		CSpawnPoint(Vector(84.4875, 830.559, -255.969), QAngle(-1.45399, -103.151, -0)),
		CSpawnPoint(Vector(-29.7929, 307.862, -254.969), QAngle(-5.41069, -9.68834, 0)),
		CSpawnPoint(Vector(-11.804, 91.7586, -251.969), QAngle(-6.57229, 19.1748, -0)),
		CSpawnPoint(Vector(341.465, -70.9734, -223.969), QAngle(19.2007, 125.074, 0)),
		CSpawnPoint(Vector(215.26, 456.066, -223.969), QAngle(19.3822, -53.0433, 0)),
		CSpawnPoint(Vector(-111.969, -776.37, -255.969), QAngle(-15.4295, 52.5336, 0)),
		CSpawnPoint(Vector(580.823, -566.341, -255.969), QAngle(4.02731, -36.5827, -0)),
		CSpawnPoint(Vector(978.497, -566.776, -255.969), QAngle(5.58822, -142.869, -0)),
		CSpawnPoint(Vector(653.304, -318.137, -223.969), QAngle(14.3365, 161.955, 0)),
		CSpawnPoint(Vector(160.031, -485.371, -223.969), QAngle(-19.4588, 22.4046, 0)),
		CSpawnPoint(Vector(703.969, -485.443, -47.9688), QAngle(11.9044, 126.876, 0)),
		CSpawnPoint(Vector(204.476, -488.907, -47.9688), QAngle(10.7429, 46.1086, 0)),
		CSpawnPoint(Vector(271.222, -282.707, -47.9688), QAngle(6.60465, 9.6997, 0)),
		CSpawnPoint(Vector(757.597, -13.2536, -47.9688), QAngle(2.57528, -43.1531, 0)),
		CSpawnPoint(Vector(1055.97, -495.969, -47.9688), QAngle(4.06362, 121.117, 0)),
		CSpawnPoint(Vector(772.794, -463.717, -47.9688), QAngle(4.71701, 56.3838, -0)),
		CSpawnPoint(Vector(1106.24, -611.619, -47.9688), QAngle(6.16909, 41.4385, 0)),
		CSpawnPoint(Vector(1478.64, -189.26, -47.9688), QAngle(2.53909, -130.188, 0)),
		CSpawnPoint(Vector(1357.97, -185.787, -47.9688), QAngle(4.7897, -100.131, 0)),
		CSpawnPoint(Vector(1253.17, -192.665, -47.9688), QAngle(5.26161, -57.0433, 0)),
		CSpawnPoint(Vector(1631.97, -511.969, -47.9688), QAngle(4.0637, 136.835, 0)),
		CSpawnPoint(Vector(1591.88, -113.871, -47.9688), QAngle(8.2019, 164.423, 0)),
		CSpawnPoint(Vector(1141.33, 242.98, -47.9688), QAngle(1.4501, -170.929, 0)),
		CSpawnPoint(Vector(1162.03, 102.984, -47.9688), QAngle(4.3904, 156.038, 0)),
		CSpawnPoint(Vector(481.019, 70.6954, -47.9688), QAngle(9.00051, 56.7217, 0)),
		CSpawnPoint(Vector(451.684, 284.327, -47.9688), QAngle(6.74991, -44.9182, 0)),
		CSpawnPoint(Vector(650.562, 400.242, -47.9688), QAngle(10.8881, 127.094, 0)),
		CSpawnPoint(Vector(190.362, 566.403, -47.9688), QAngle(10.6341, 38.6446, 0)),
		CSpawnPoint(Vector(179.441, 855.583, -47.9688), QAngle(15.9702, -51.7061, 0)),
		CSpawnPoint(Vector(471.146, 827.204, -47.9688), QAngle(15.3167, -104.558, -0)),
		CSpawnPoint(Vector(826.315, 970.179, -47.9688), QAngle(0.288556, -39.2189, 0)),
		CSpawnPoint(Vector(1631.97, 879.969, -47.9688), QAngle(-0.1833, -130.368, 0)),
		CSpawnPoint(Vector(719.031, 378.031, -45.9688), QAngle(1.9221, 35.0885, 0)),
		CSpawnPoint(Vector(1005.97, 378.031, -45.9688), QAngle(3.91859, 122.753, 0)),
		CSpawnPoint(Vector(719.031, 733.969, -45.9688), QAngle(1.84949, -57.0046, 0)),
		CSpawnPoint(Vector(895.184, 516.708, -45.9688), QAngle(6.5322, 77.2327, 0)),
		CSpawnPoint(Vector(1391.97, 408.031, -47.9688), QAngle(0.833115, 127.231, 0)),
		CSpawnPoint(Vector(1072.03, 623.969, -223.969), QAngle(-1.88939, -22.6403, 0)),
		CSpawnPoint(Vector(988.843, -29.9152, -223.969), QAngle(4.82611, -53.8825, 0)),
		CSpawnPoint(Vector(1040.56, -468.041, -223.969), QAngle(2.0673, 35.3066, 0)),
		CSpawnPoint(Vector(903.969, -367.969, -223.969), QAngle(-1.78052, 145.768, 0)),
		CSpawnPoint(Vector(416.031, -111.969, -223.969), QAngle(0.5065, 51.6063, 0)),
		CSpawnPoint(Vector(716.233, -1.91156, -223.969), QAngle(3.22898, -150.258, 0)),
		CSpawnPoint(Vector(454.107, 76.8016, -223.969), QAngle(-3.15974, 22.8934, 0)),
		CSpawnPoint(Vector(486.55, 263.187, -223.969), QAngle(3.37426, -32.2826, 0)),
		CSpawnPoint(Vector(1351.04, 591.49, -223.969), QAngle(3.12015, -135.919, 0)),
		CSpawnPoint(Vector(876.414, 42.0792, -223.969), QAngle(7.29467, 100.334, 0))
	}
};

int iSurvInBasement;
bool bIsBZSEnabled;

const int TEAM_LOBBYGUYS = 0;
const int TEAM_SURVIVORS = 2;

void OnMapInit()
{
	Events::Player::OnPlayerSpawn.Hook(@OnPlayerSpawn);
	OnNewRound();
}

void OnNewRound()
{
	Schedule::Task(0.05f, "SetUpStuff");
}

void OnMatchStarting()
{
	bIsBZSEnabled = false;
}

void OnMatchBegin() 
{
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(New_ZombieSpawns, false);
}

void SetUpStuff()
{
	Engine.Ent_Fire("Precache", "kill");
	Engine.Ent_Fire("shading", "StartOverlays");
	PlayLobbyAmbient();

	RemoveNativeSpawns("info_player_zombie");
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(New_Spawns, true);
}

HookReturnCode OnPlayerSpawn(CZP_Player@ pPlayer)
{
	CBasePlayer@ pPlrEnt = pPlayer.opCast();
	CBaseEntity@ pBaseEnt = pPlrEnt.opCast();

	if (pBaseEnt.GetTeamNumber() != TEAM_LOBBYGUYS)
	{
		Engine.Ent_Fire_Ent(pBaseEnt, "SetFogController", "base_fog");
	}

	else
	{
		Engine.Ent_Fire_Ent(pBaseEnt, "SetFogController", "lobby_fog");
		PlayLobbyAmbient();
	}

	return HOOK_CONTINUE;	
}