#include "cszm_modules/lobbyambient"
#include "cszm_modules/newspawn"
#include "cszm_modules/cashmaker"

array<array<CSpawnPoint@>> New_Spawns = 
{
	{
		CSpawnPoint(Vector(907.069, -1158.95, -143.969), QAngle(0, -170.26, 0)),
		CSpawnPoint(Vector(902.541, -1304.11, -143.969), QAngle(0.1815, 166.15, 0)),
		CSpawnPoint(Vector(767.353, -1291.4, -143.969), QAngle(0, 148.866, 0)),
		CSpawnPoint(Vector(698.493, -1205.65, -143.969), QAngle(0, -174.944, 0)),
		CSpawnPoint(Vector(613.716, -1300.02, -143.969), QAngle(0.1089, 149.812, 0)),
		CSpawnPoint(Vector(549.914, -1174.2, -143.969), QAngle(0.1815, -157.991, 0)),
		CSpawnPoint(Vector(487.374, -1299.75, -143.969), QAngle(0, 178.017, 0)),
		CSpawnPoint(Vector(373.205, -1271.23, -143.969), QAngle(0, -169.175, 0)),
		CSpawnPoint(Vector(256.655, -1315.95, -143.969), QAngle(0, 161.569, 0)),
		CSpawnPoint(Vector(167.273, -1170.54, -143.969), QAngle(0.0726, -136.798, 0)),
		CSpawnPoint(Vector(-842.68, 27.8867, -191.969), QAngle(0, -28.9339, 0)),
		CSpawnPoint(Vector(-812.34, -83.3114, -191.969), QAngle(0, -3.04536, 0)),
		CSpawnPoint(Vector(-762.45, -172.683, -191.969), QAngle(0, -24.1698, 0)),
		CSpawnPoint(Vector(-737.996, -34.1848, -191.969), QAngle(0, -22.4584, 0)),
		CSpawnPoint(Vector(-646.135, -183.45, -191.969), QAngle(0, -36.1048, 0)),
		CSpawnPoint(Vector(-650.586, -18.7945, -191.969), QAngle(0, -43.83, 0)),
		CSpawnPoint(Vector(-558.896, -105.291, -191.969), QAngle(0.0363, -11.7044, 0)),
		CSpawnPoint(Vector(-568.143, -303.677, -191.969), QAngle(0, 32.513, 0)),
		CSpawnPoint(Vector(-536.902, -205.654, -191.969), QAngle(0.1452, -24.2283, 0)),
		CSpawnPoint(Vector(-625.858, -249.056, -191.969), QAngle(0, 8.69993, 0)),
		CSpawnPoint(Vector(-231.278, -1001.27, -143.969), QAngle(0, -175.963, 0)),
		CSpawnPoint(Vector(-237.053, -919.458, -143.969), QAngle(0, -175.963, 0)),
		CSpawnPoint(Vector(-243.861, -822.996, -143.969), QAngle(0, -175.963, 0)),
		CSpawnPoint(Vector(-399.824, -992.532, -143.969), QAngle(0.0726, 37.0063, 0)),
		CSpawnPoint(Vector(226.393, 100.908, -143.969), QAngle(0.1452, -135.072, 0))
	},
	{
		CSpawnPoint(Vector(-260.33, -562.995, -143.969)), 
		CSpawnPoint(Vector(-162.768, -542.458, -143.969)),
		CSpawnPoint(Vector(-92.6469, -591.64, -143.969)), 
		CSpawnPoint(Vector(8.41257, -579.925, -143.969)), 
		CSpawnPoint(Vector(-84.0908, -501.808, -143.969)),
		CSpawnPoint(Vector(-142.569, -424.55, -143.969)), 
		CSpawnPoint(Vector(-250.47, -456.703, -143.969)), 
		CSpawnPoint(Vector(-4.0595, -465.13, -143.969)),
		CSpawnPoint(Vector(-286.332, -390.288, -143.969)),
		CSpawnPoint(Vector(-171.014, -323.457, -143.969)),
		CSpawnPoint(Vector(-28.8815, -332.674, -143.969)),
		CSpawnPoint(Vector(-61.0384, -402.101, -143.969)),
		CSpawnPoint(Vector(-29.6997, -205.769, -143.969)),
		CSpawnPoint(Vector(-170.698, -228.529, -143.969)),
		CSpawnPoint(Vector(-265.845, -274.57, -143.969)), 
		CSpawnPoint(Vector(-241.153, -178.307, -143.969)),
		CSpawnPoint(Vector(-146.514, -151.006, -143.969)),
		CSpawnPoint(Vector(-97.8256, -290.105, -143.969)),
		CSpawnPoint(Vector(64.0009, -265, -143.969)),
		CSpawnPoint(Vector(33.8773, -116.878, -143.969)), 
		CSpawnPoint(Vector(-53.7206, -93.3592, -143.969)),
		CSpawnPoint(Vector(-200.888, -84.5608, -143.969)),
		CSpawnPoint(Vector(-308.86, -75.1568, -143.969)), 
		CSpawnPoint(Vector(221.121, -353.105, -143.969)), 
		CSpawnPoint(Vector(230.735, -92.9227, -143.969)), 
		CSpawnPoint(Vector(19.2015, 82.2281, -143.969)),
		CSpawnPoint(Vector(-211.617, 66.8983, -143.969)),
		CSpawnPoint(Vector(204.528, 70.9945, -143.969))
	},
	{
		CSpawnPoint(Vector(13.4294, -591.303, -143.969), QAngle(1.92377, 125.674, 0)),
		CSpawnPoint(Vector(-249.788, -505.83, -143.969), QAngle(0.217654, 66.2141, 0)),
		CSpawnPoint(Vector(-156.527, 57.0538, -143.969), QAngle(4.06545, -68.2047, 0)),
		CSpawnPoint(Vector(185.578, -106.557, -143.969), QAngle(1.23405, -156.378, -0)),
		CSpawnPoint(Vector(-774.829, -34.2208, -191.969), QAngle(1.85116, -43.5211, 0)),
		CSpawnPoint(Vector(-533.725, -983.845, -143.969), QAngle(3.52096, 25.2312, 0)),
		CSpawnPoint(Vector(-151.788, -734.38, -143.969), QAngle(1.99636, -146.445, 0)),
		CSpawnPoint(Vector(27.0907, -1238.88, -143.969), QAngle(1.70596, 127.766, 0)),
		CSpawnPoint(Vector(883.793, -1166.5, -143.969), QAngle(1.56076, -150.922, 0)),
		CSpawnPoint(Vector(707.004, -707.963, -143.969), QAngle(6.78791, -137.273, 0)),
		CSpawnPoint(Vector(171.298, -858.78, -143.969), QAngle(5.0455, 37.8507, 0)),
		CSpawnPoint(Vector(-77.4337, -7.16623, -303.969), QAngle(5.11807, -104.834, 0)),
		CSpawnPoint(Vector(566.494, -526.992, -447.969), QAngle(17.4964, -109.068, 0)),
		CSpawnPoint(Vector(1193.87, -538.038, -447.969), QAngle(8.16736, 155.196, 0)),
		CSpawnPoint(Vector(1071.04, -971.843, -447.969), QAngle(15.8267, 179.88, 0)),
		CSpawnPoint(Vector(177.671, -1124.83, -543.969), QAngle(3.84764, 51.9226, 0)),
		CSpawnPoint(Vector(348.052, -738.362, -543.969), QAngle(5.91673, -29.4136, 0)),
		CSpawnPoint(Vector(183.597, -854.75, 0.03125), QAngle(3.92022, 32.466, 0)),
		CSpawnPoint(Vector(-375.066, -433.984, 0.03125), QAngle(12.9952, 38.746, 0)),
		CSpawnPoint(Vector(656.781, -1278.78, 48.0313), QAngle(1.74223, 142.068, 0)),
		CSpawnPoint(Vector(-450.728, -873.861, 48.0313), QAngle(18.7306, -51.8592, 0)),
		CSpawnPoint(Vector(-705.187, 80.3288, 64.0313), QAngle(2.79493, -0.953661, 0)),
		CSpawnPoint(Vector(164.025, -159.807, 0.03125), QAngle(24.2482, -161.073, 0)),
		CSpawnPoint(Vector(-121.013, -1189.39, 48.0313), QAngle(24.2845, 109.061, 0))
	}
};

array<array<CSpawnPoint@>> New_ZombieSpawns = 
{
	{
		CSpawnPoint(Vector(-840.799, 27.124, -191.969), QAngle(-2.40625, -35.335, 0)),
		CSpawnPoint(Vector(-817, -124.178, -191.969), QAngle(-0.0830525, -25.2436, 0)),
		CSpawnPoint(Vector(-603.006, -29.6581, -191.969), QAngle(0.679249, -51.9214, -0)),
		CSpawnPoint(Vector(-562.361, -932.091, -143.969), QAngle(4.89005, 41.1127, 0)),
		CSpawnPoint(Vector(-499.658, -1032.38, -143.969), QAngle(5.21675, 32.9089, 0)),
		CSpawnPoint(Vector(-421.775, -1137.49, -143.969), QAngle(6.37836, 47.9909, 0)),
		CSpawnPoint(Vector(-308.629, -1235.7, -143.969), QAngle(7.10436, 56.5962, 0)),
		CSpawnPoint(Vector(-258.144, -812.857, -143.969), QAngle(10.5892, -169.259, 0)),
		CSpawnPoint(Vector(-264.432, -931.245, -143.969), QAngle(12.4405, -139.963, -0)),
		CSpawnPoint(Vector(-220.57, -1023.68, -143.969), QAngle(8.48376, -136.044, 0)),
		CSpawnPoint(Vector(963.969, -1343.97, -143.969), QAngle(6.30575, 160.794, 0)),
		CSpawnPoint(Vector(963.969, -1236.3, -143.969), QAngle(6.19685, 178.109, 0)),
		CSpawnPoint(Vector(963.969, -1120.03, -143.969), QAngle(8.04816, -170.42, 0)),
		CSpawnPoint(Vector(878.232, -1138.43, -143.969), QAngle(7.57626, 171.817, 0)),
		CSpawnPoint(Vector(863.55, -1231.54, -143.969), QAngle(7.50366, 172.882, -0)),
		CSpawnPoint(Vector(851.056, -1333.1, -143.969), QAngle(8.22966, 166.197, -0)),
		CSpawnPoint(Vector(495.613, -1311.76, -143.969), QAngle(7.79406, 162.863, -0)),
		CSpawnPoint(Vector(354.401, -1331.37, -143.969), QAngle(7.75776, 152.749, -0)),
		CSpawnPoint(Vector(-10.3748, -1338.44, -143.969), QAngle(4.99895, 127.915, -0)),
		CSpawnPoint(Vector(6.77159, -765.204, 0.03125), QAngle(19.5553, -126.243, 0)),
		CSpawnPoint(Vector(49.4534, -559.435, 0.03125), QAngle(18.3574, -127.659, 0)),
		CSpawnPoint(Vector(-445.295, -627.125, 0.03125), QAngle(14.437, 25.0914, -0)),
		CSpawnPoint(Vector(-441.013, -87.9149, 0.03125), QAngle(17.8492, -28.456, 0)),
		CSpawnPoint(Vector(-423.908, -386.047, 0.03125), QAngle(20.0272, 7.26811, 0)),
		CSpawnPoint(Vector(193.339, -858.543, 0.03125), QAngle(8.3386, 23.7483, 0)),
		CSpawnPoint(Vector(340.567, -653.397, 0.03125), QAngle(8.15711, -37.8165, 0)),
		CSpawnPoint(Vector(593.429, -743.296, 0.03125), QAngle(4.41821, -171.8, 0)),
		CSpawnPoint(Vector(645.927, -986.401, 48.0313), QAngle(7.75782, -148.314, 0)),
		CSpawnPoint(Vector(426.278, -979.429, 48.0313), QAngle(6.99551, -89.2749, 0)),
		CSpawnPoint(Vector(665.976, -1280.47, 48.0313), QAngle(8.01191, 145.806, 0)),
		CSpawnPoint(Vector(427.012, -1260.59, 48.0313), QAngle(6.74141, 89.9721, 0)),
		CSpawnPoint(Vector(117.302, -1273.98, 48.0313), QAngle(5.90651, 163.988, 0)),
		CSpawnPoint(Vector(-216.313, -1258.21, 48.0313), QAngle(14.1466, 69.2488, -0)),
		CSpawnPoint(Vector(-575.969, -1366.09, 48.0313), QAngle(5.2168, 36.4665, 0)),
		CSpawnPoint(Vector(-523.636, -1236.23, 48.0313), QAngle(11.0611, 47.0521, -0)),
		CSpawnPoint(Vector(-510.347, -1007.92, 48.0313), QAngle(14.9815, 17.5226, -0)),
		CSpawnPoint(Vector(-499.136, -790.502, 48.0313), QAngle(18.6115, 1.69844, -0)),
		CSpawnPoint(Vector(-706.297, -823.765, 48.0313), QAngle(9.31869, 62.7477, 0)),
		CSpawnPoint(Vector(-602.88, -585.802, 64.0313), QAngle(10.6618, 116.689, 0)),
		CSpawnPoint(Vector(-690.366, 103.935, 64.0313), QAngle(11.6782, -42.0868, -0)),
		CSpawnPoint(Vector(-366.532, 39.7942, 64.0313), QAngle(28.0132, 17.4975, 0)),
		CSpawnPoint(Vector(-123.882, 96.374, 0.03125), QAngle(10.4077, -49.0537, 0)),
		CSpawnPoint(Vector(248.334, 92.0275, 0.03125), QAngle(11.6782, -134.327, -0)),
		CSpawnPoint(Vector(219.485, -188.497, 0.03125), QAngle(14.074, 174.819, 0)),
		CSpawnPoint(Vector(207.091, -532.882, 64.0313), QAngle(6.16061, 6.84561, 0)),
		CSpawnPoint(Vector(838.288, -521.822, 64.0313), QAngle(5.03531, 179.247, 0)),
		CSpawnPoint(Vector(189.197, -847.057, -143.969), QAngle(4.56341, 33.2983, -0)),
		CSpawnPoint(Vector(706.456, -698.943, -143.969), QAngle(4.70861, -152.094, -0)),
		CSpawnPoint(Vector(700.76, -987.696, -143.969), QAngle(6.95922, 107.821, 0)),
		CSpawnPoint(Vector(203.483, -446.414, -143.969), QAngle(5.0716, -114.746, 0)),
		CSpawnPoint(Vector(233.963, 105.342, -143.969), QAngle(4.09149, -141.89, -0)),
		CSpawnPoint(Vector(228.475, -148.144, -143.969), QAngle(8.15709, -166.217, -0)),
		CSpawnPoint(Vector(3.76994, 90.1935, -143.969), QAngle(10.9885, -89.8063, -0)),
		CSpawnPoint(Vector(-258.228, 90.4536, -143.969), QAngle(9.75426, -71.2688, 0)),
		CSpawnPoint(Vector(71.7604, -384.3, -143.969), QAngle(1.40525, 116.425, 0)),
		CSpawnPoint(Vector(23.4667, -585.52, -143.969), QAngle(6.30577, 126.371, 0)),
		CSpawnPoint(Vector(-170.724, -546.001, -143.969), QAngle(5.83386, 68.5088, 0)),
		CSpawnPoint(Vector(-495.969, 303.969, -223.969), QAngle(-8.75874, -73.2557, 0)),
		CSpawnPoint(Vector(-495.969, 16.0313, -271.969), QAngle(-11.2997, 27.7672, 0)),
		CSpawnPoint(Vector(-176.712, 80.148, -303.969), QAngle(14.6911, -54.6337, 0)),
		CSpawnPoint(Vector(-284.919, -389.818, -303.969), QAngle(25.0729, 21.3785, 0)),
		CSpawnPoint(Vector(215.337, -304.031, -447.969), QAngle(-34.2776, -160.049, 0)),
		CSpawnPoint(Vector(110.456, -540.45, -447.969), QAngle(7.72154, 25.2993, 0)),
		CSpawnPoint(Vector(454.596, -516.006, -447.969), QAngle(17.1232, -92.0176, -0)),
		CSpawnPoint(Vector(559.135, -526.535, -447.969), QAngle(23.8024, -127.215, 0)),
		CSpawnPoint(Vector(1347.24, -435.019, -447.969), QAngle(2.89366, -128.976, 0)),
		CSpawnPoint(Vector(1134.1, -985.006, -447.969), QAngle(6.26957, 133.74, 0)),
		CSpawnPoint(Vector(159.646, -1150.16, -543.969), QAngle(2.24027, 49.8155, 0)),
		CSpawnPoint(Vector(579.909, -1148.27, -519.018), QAngle(5.90655, 122.488, 0)),
		CSpawnPoint(Vector(322.64, -721.232, -543.964), QAngle(4.56346, -59.629, 0)),
		CSpawnPoint(Vector(547.238, -504.443, -543.964), QAngle(5.14425, -91.3189, 0)),
		CSpawnPoint(Vector(446.102, -526.658, -543.964), QAngle(5.28945, -92.6983, 0))
	}
};

const int TEAM_LOBBYGUYS = 0;

float flFan1FLTime = 0.0f;
float flFan2FLTime = 0.0f;

int iF1SPitch = 0;
bool bFan1IsOn = false;
float flFan1Delay = 0.0f;

int iF2SPitch = 0;
bool bFan2IsOn = false;
float flFan2Delay = 0.0f;

void SD(const string &in strMSG)
{
	Chat.PrintToChat(all, strMSG);
}

void OnMapInit()
{
	Entities::RegisterUse("func_button");
	Events::Trigger::OnStartTouch.Hook(@OnStartTouch);
	Events::Player::OnPlayerSpawn.Hook(@OnPlayerSpawn);

	CashData();
	OnNewRound();
}

void OnMatchBegin() 
{
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(New_ZombieSpawns, false);
}

void OnNewRound()
{	
	bFan1IsOn = false;
	bFan2IsOn = false;
	iF1SPitch = 0;
	iF2SPitch = 0;
	Schedule::Task(0.05f, "SetUpStuff");
}

void OnProcessRound()
{
	if (flFan1FLTime <= Globals.GetCurrentTime() && bFan1IsOn)
	{
		flFan1FLTime = Globals.GetCurrentTime() + 1.1f;
		Engine.Ent_Fire("snd_fan1", "Volume", "10");
	}

	if (flFan2FLTime <= Globals.GetCurrentTime() && bFan2IsOn)
	{
		flFan2FLTime = Globals.GetCurrentTime() + 1.1f;
		Engine.Ent_Fire("snd_fan2", "Volume", "10");
	}
}

void SetUpStuff()
{
	Engine.Ent_Fire("screenoverlay", "StartOverlays");
	Engine.Ent_Fire("Precache", "Kill");
	Engine.Ent_Fire("vrad*", "Kill");
	
	Engine.Ent_Fire("tonemap", "SetBloomScale", "0.375");

	Engine.Ent_Fire("hurt_toxic*", "addoutput", "spawnflags 1088", "0.05");

	TurnOnFan1();

	PlayLobbyAmbient();

	RemoveNativeSpawns("info_player_zombie");
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(New_Spawns, true);
}

void CashData()
{
	MaxRandomCash = 12;
	MinRandomCash = 6;
	MaxMoneyPerItem = 175.0f;
	MinMoneyPerItem = 45.0f;

	InsertToArray(-356.433, -1429.81, 154.526);
	InsertToArray(-355.539, -1410.98, 154.526);
	InsertToArray(403.124, -914.462, 161.031);
	InsertToArray(394.451, -769.401, 145.031);
	InsertToArray(910.001, -408.19, 422.79);
	InsertToArray(920.474, -390.295, 422.763);
	InsertToArray(909.233, -382.09, 422.725);
	InsertToArray(1233.67, -362.098, -359.874);
	InsertToArray(410.493, -377.005, -542.969);
	InsertToArray(432.5, -1206.51, -302.969);
	InsertToArray(417.573, -1218.17, -302.969);
	InsertToArray(367.772, -1176.92, -302.969);
	InsertToArray(-339.996, -381.77, -230.074);
	InsertToArray(-518.024, 89.659, -142.969);
	InsertToArray(-122.988, -820.316, -142.969);
	InsertToArray(-289.004, -719.739, -109.054);
	InsertToArray(-312.326, -724.114, -109.032);
	InsertToArray(79.2919, -451.216, 1.03125);
	InsertToArray(71.0485, -429.527, 1.03125);
	InsertToArray(62.9824, -446.235, 1.03125);
	InsertToArray(-529.314, -354.646, 81.0313);
	InsertToArray(-536.301, -341.571, 81.0313);
}

HookReturnCode OnPlayerSpawn(CZP_Player@ pPlayer)
{
	CBasePlayer@ pPlrEnt = pPlayer.opCast();
	CBaseEntity@ pBaseEnt = pPlrEnt.opCast();

	if (pBaseEnt.GetTeamNumber() == TEAM_LOBBYGUYS)
	{
		PlayLobbyAmbient();
	}

	return HOOK_CONTINUE;	
}

HookReturnCode OnStartTouch(CBaseEntity@ pTrigger, const string &in strEntityName, CBaseEntity@ pEntity)
{
	if (strEntityName == "hurt_toxic1" || strEntityName == "hurt_toxic2")
	{
		if (!pEntity.IsPlayer())
		{
			if (Utils.StrContains("weapon_", pEntity.GetClassname()) || Utils.StrContains("item_", pEntity.GetClassname()))
			{
				pEntity.SUB_Remove();
			}
		}
	}

	return HOOK_CONTINUE;
}

void OnEntityUsed(CZP_Player@ pPlayer, CBaseEntity@ pEntity)
{
	if (pEntity.GetEntityName() == "button_fan1")
	{
		if (flFan1Delay <= Globals.GetCurrentTime())
		{
			if (iF1SPitch == 100 || iF1SPitch == 0)
			{
				Engine.EmitSoundEntity(pEntity, "Buttons.snd14");
				flFan1Delay = Globals.GetCurrentTime() + 20.0f;

				if (bFan1IsOn)
				{
					bFan1IsOn = false;
					iF1SPitch = 100;
					Fan1SNDStop();
					Engine.Ent_Fire("func_fan1", "stop");
					Engine.Ent_Fire("fanpush", "disable", "0", "0.75");
					Schedule::Task(10.0f, "TurnOnFan1");
				}

				else
				{
					bFan1IsOn = true;
					iF1SPitch = 0;
					Fan1SNDPlay();
					Engine.Ent_Fire("func_fan1", "start");
					Engine.Ent_Fire("fanpush", "enable", "0", "1.25");
				}
			}
		}
	}

	if (pEntity.GetEntityName() == "button_fan2")
	{
		if (flFan2Delay <= Globals.GetCurrentTime())
		{
			if (iF2SPitch == 100 || iF2SPitch == 0)
			{
				Engine.EmitSoundEntity(pEntity, "Buttons.snd14");
				flFan2Delay = Globals.GetCurrentTime() + 45.0f;

				if (bFan2IsOn)
				{
					bFan2IsOn = false;
					iF2SPitch = 100;
					Fan2SNDStop();
					Engine.Ent_Fire("func_fan2", "stop");
					Engine.Ent_Fire("fanpush2", "disable", "0", "0.75");
				}

				else
				{
					bFan2IsOn = true;
					iF2SPitch = 0;
					Fan2SNDPlay();
					Engine.Ent_Fire("func_fan2", "start");
					Engine.Ent_Fire("fanpush2", "enable", "0", "1.25");
					Schedule::Task(10.0f, "TurnOffFan2");
				}
			}
		}
	}
}

void Fan1SNDPlay()
{
	if (iF1SPitch == 0)
	{
		Engine.Ent_Fire("snd_fan1", "Volume", "10");
	}

	iF1SPitch++;

	Engine.Ent_Fire("snd_fan1", "Pitch", formatInt(iF1SPitch));

	if (iF1SPitch != 100 && iF1SPitch > 0 && iF1SPitch < 100)
	{
		Schedule::Task(0.025f, "Fan1SNDPlay");
	}
}

void Fan1SNDStop()
{
	iF1SPitch--;

	Engine.Ent_Fire("snd_fan1", "Pitch", formatInt(iF1SPitch));

	if (iF1SPitch != 0 && iF1SPitch > 0 && iF1SPitch < 100)
	{
		Schedule::Task(0.025f, "Fan1SNDStop");
	}

	if (iF1SPitch == 0)
	{
		Engine.Ent_Fire("snd_fan1", "Volume", "0");
	}
}

void Fan2SNDPlay()
{
	if (iF2SPitch == 0)
	{
		Engine.Ent_Fire("snd_fan2", "Volume", "10");
	}

	iF2SPitch++;

	Engine.Ent_Fire("snd_fan2", "Pitch", formatInt(iF2SPitch));

	if (iF2SPitch != 100 && iF2SPitch > 0 && iF2SPitch < 100)
	{
		Schedule::Task(0.025f, "Fan2SNDPlay");
	}
}

void Fan2SNDStop()
{
	iF2SPitch--;

	Engine.Ent_Fire("snd_fan2", "Pitch", formatInt(iF2SPitch));

	if (iF2SPitch > 0)
	{
		Schedule::Task(0.025f, "Fan2SNDStop");
	}

	if (iF2SPitch == 0)
	{
		Engine.Ent_Fire("snd_fan2", "Volume", "0");
	}
}

void TurnOnFan1()
{
	if (!bFan1IsOn)
	{
		bFan1IsOn = true;
		iF1SPitch = 0;
		Fan1SNDPlay();
		Engine.Ent_Fire("func_fan1", "start");
		Engine.Ent_Fire("fanpush", "enable", "0", "0.75");
	}
}

void TurnOffFan2()
{
	if (bFan2IsOn)
	{
		bFan2IsOn = false;
		iF2SPitch = 100;
		Fan2SNDStop();
		Engine.Ent_Fire("func_fan2", "stop");
		Engine.Ent_Fire("fanpush2", "disable", "0", "0.75");
	}
}