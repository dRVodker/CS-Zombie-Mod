#include "cszm_modules/lobbyambient"
#include "cszm_modules/newspawn"

array<array<CSpawnPoint@>> LockDown_Spawns =
{
	{
		CSpawnPoint(Vector(-4138.46, 4427.45, 0.03125), QAngle(10.6716, 42.0047, -0)),
		CSpawnPoint(Vector(-4137.89, 4426.77, 0.03125), QAngle(1.77814, 39.754, 0)),
		CSpawnPoint(Vector(-4151.63, 4678.58, 0.03125), QAngle(0.507613, -61.0148, 0)),
		CSpawnPoint(Vector(-3808.63, 4525.52, 0.03125), QAngle(19.8192, -67.4398, 0)),
		CSpawnPoint(Vector(-4087.83, 4200.32, 0.03125), QAngle(0.979468, 43.9648, 0)),
		CSpawnPoint(Vector(-3667.46, 4105.66, 0.03125), QAngle(1.01578, 103.388, 0)),
		CSpawnPoint(Vector(-3399.12, 4203.44, 0.03125), QAngle(1.92328, 143.898, 0)),
		CSpawnPoint(Vector(-3593.6, 4627.66, 0.03125), QAngle(1.19727, 93.6954, 0)),
		CSpawnPoint(Vector(-3870.61, 4953.78, 64.0313), QAngle(23.2314, -10.3043, 0)),
		CSpawnPoint(Vector(-3668.6, 5077.55, 0.03125), QAngle(-3.19502, 38.4103, 0)),
		CSpawnPoint(Vector(-4049.39, 5372.5, 0.03125), QAngle(4.31906, 59.0651, 0)),
		CSpawnPoint(Vector(-3835.77, 6147.69, 0.03125), QAngle(0.68908, -99.8198, 0)),
		CSpawnPoint(Vector(-3522.66, 5632.35, 0.03125), QAngle(0.108292, -98.8032, 0)),
		CSpawnPoint(Vector(-3099.86, 5611.55, 0.03125), QAngle(0.471292, -66.0606, 0)),
		CSpawnPoint(Vector(-2781.72, 5177.34, 0.03125), QAngle(-0.0731959, 138.285, 0)),
		CSpawnPoint(Vector(-3125.79, 4958.2, 0.03125), QAngle(2.97601, -44.8255, 0)),
		CSpawnPoint(Vector(-2727.08, 4862.72, 0.03125), QAngle(-20.4375, -150.495, 0)),
		CSpawnPoint(Vector(-3415.07, 5011.39, 128.031), QAngle(0.362355, -74.0833, 0)),
		CSpawnPoint(Vector(-3347.04, 4495.15, 128.031), QAngle(2.39514, 21.5309, 0)),
		CSpawnPoint(Vector(-3099.01, 4757.98, 128.031), QAngle(3.95603, -119.386, 0)),
		CSpawnPoint(Vector(-3565.11, 4006.01, 128.031), QAngle(22.3964, 77.2149, 0)),
		CSpawnPoint(Vector(-2854.44, 4079.57, 128.031), QAngle(14.0111, 105.311, 0)),
		CSpawnPoint(Vector(-2696.39, 3296.03, 128.031), QAngle(-2.61427, 62.6818, 0)),
		CSpawnPoint(Vector(-2469.49, 3973.31, 128.031), QAngle(8.85652, 122.395, 0)),
		CSpawnPoint(Vector(-3647.25, 3435.77, 0.03125), QAngle(-2.25129, 16.4353, 0)),
		CSpawnPoint(Vector(-3045.41, 3585.16, 0.03125), QAngle(-0.545187, 111.977, -0))
	},
	{
		CSpawnPoint(Vector(-3879.11, 3210.04, 9.89143), QAngle(13.6844, -112.66, 0)),
		CSpawnPoint(Vector(-4117.35, 3104.47, -0.374029), QAngle(12.305, -45.3598, 0)),
		CSpawnPoint(Vector(-4023.79, 2603.67, 0.03125), QAngle(11.9783, 32.9393, 0)),
		CSpawnPoint(Vector(-3758.99, 2526.92, 0.03125), QAngle(9.40102, 119.333, 0)),
		CSpawnPoint(Vector(-3566.34, 2095.71, -1.28776), QAngle(12.5954, 103.361, 0)),
		CSpawnPoint(Vector(-3326.91, 2351.28, -1.99408), QAngle(-0.835587, 141.44, 0)),
		CSpawnPoint(Vector(-2951.95, 3187.42, 0.03125), QAngle(2.43142, -154.2, 0)),
		CSpawnPoint(Vector(-3027.84, 2549.77, -2.14899), QAngle(3.52042, 171.424, 0)),
		CSpawnPoint(Vector(-3432.03, 3113.48, -0.308811), QAngle(6.27923, 107.137, 0)),
		CSpawnPoint(Vector(-4121.55, 1385.49, 0.03125), QAngle(7.36823, 50.1331, 0)),
		CSpawnPoint(Vector(-3252.05, 1399.21, -4.63077), QAngle(4.21011, 118.631, 0)),
		CSpawnPoint(Vector(-3671.2, 1807.71, 0.03125), QAngle(7.11411, -19.7805, 0)),
		CSpawnPoint(Vector(-2885.79, 2018.13, -3.95109), QAngle(0.725327, -151.09, 0)),
		CSpawnPoint(Vector(-3159.52, 2171.03, -0.748093), QAngle(4.13752, -55.1491, 0)),
		CSpawnPoint(Vector(-2784.2, 1639.7, 128.031), QAngle(15.6446, 179.422, 0)),
		CSpawnPoint(Vector(-2779.69, 2284.49, 128.031), QAngle(9.03806, 136.261, 0)),
		CSpawnPoint(Vector(-2626.5, 3060.99, 128.031), QAngle(-1.38005, 144.283, 0)),
		CSpawnPoint(Vector(-2704, 3733.18, 128.031), QAngle(-8.49485, -48.9777, 0)),
		CSpawnPoint(Vector(-2726.7, 4229.85, 128.031), QAngle(6.09776, -37.0715, 0)),
		CSpawnPoint(Vector(-3410.36, 3483.55, 0.03125), QAngle(4.17386, -109.357, 0)),
		CSpawnPoint(Vector(-3607.06, 3492.89, 1.03125), QAngle(3.91976, -40.4963, 0)),
		CSpawnPoint(Vector(-2813.5, 3582.39, 128.031), QAngle(29.5476, -164.51, 0)),
		CSpawnPoint(Vector(-2879.74, 4007.58, 128.031), QAngle(18.7665, -97.8993, 0)),
		CSpawnPoint(Vector(-3367, 2647.56, -3.15575), QAngle(3.702, -131.477, 0))
	},
	{
		CSpawnPoint(Vector(-3212.54, 1400.23, -4.57603), QAngle(0.398672, 116.755, 0)),
		CSpawnPoint(Vector(-4073.07, 1817.66, 0.03125), QAngle(1.63287, -11.2982, 0)),
		CSpawnPoint(Vector(-3666.28, 2034.6, -1.26505), QAngle(-2.46902, 84.6427, 0)),
		CSpawnPoint(Vector(-2922.2, 3177.86, 0.03125), QAngle(-6.67983, -151.865, 0)),
		CSpawnPoint(Vector(-4098.5, 3125.29, 5.43501), QAngle(-2.43271, -32.9092, 0)),
		CSpawnPoint(Vector(-3671.39, 3434.45, 0.03125), QAngle(-0.182123, 15.9146, 0)),
		CSpawnPoint(Vector(-2812.25, 4076, 0.03125), QAngle(2.03218, -133.981, 0)),
		CSpawnPoint(Vector(-3130.67, 4980.72, 0.03125), QAngle(-1.12591, -55.9362, 0)),
		CSpawnPoint(Vector(-2563.22, 4218.2, 128.031), QAngle(4.50059, -70.77, 0)),
		CSpawnPoint(Vector(-2744, 1959.34, 128.031), QAngle(4.50058, 101.486, 0)),
		CSpawnPoint(Vector(-3299.56, 4549.95, 128.031), QAngle(6.27925, 10.07, 0)),
		CSpawnPoint(Vector(-4090.81, 4267.41, 128.031), QAngle(15.3906, -9.7738, 0)),
		CSpawnPoint(Vector(-4093.06, 4712.57, 0.03125), QAngle(5.91628, -57.1575, 0)),
		CSpawnPoint(Vector(-3591.66, 5178.51, 0.03125), QAngle(2.61297, -103.998, 0)),
		CSpawnPoint(Vector(-2787.63, 5679.97, 0.03125), QAngle(3.41157, -92.8166, 0)),
		CSpawnPoint(Vector(-3997.95, 6157.16, 0.03125), QAngle(1.37877, -62.639, 0)),
		CSpawnPoint(Vector(-3218.9, 3782.72, 0.03125), QAngle(3.41157, 40.9853, 0)),
		CSpawnPoint(Vector(-2728.61, 4784.43, 128.031), QAngle(17.8227, -117.597, 0)),
		CSpawnPoint(Vector(-3285.39, 4006.23, 128.031), QAngle(4.50057, 17.9838, 0)),
		CSpawnPoint(Vector(-3668.94, 4002.49, 0.03125), QAngle(2.79448, 95.7999, 0)),
		CSpawnPoint(Vector(-3112.52, 2766.13, -2.27394), QAngle(3.91978, 160.838, 0)),
		CSpawnPoint(Vector(-3406.26, 4267.92, 0.03125), QAngle(2.39519, 156.602, 0)),
		CSpawnPoint(Vector(-4030.8, 5353.76, 0.03125), QAngle(2.39518, 25.6322, 0)),
		CSpawnPoint(Vector(-2611.9, 3220.78, 128.031), QAngle(2.10477, -121.141, 0))
	},
	{
		CSpawnPoint(Vector(-3106.91, 4750.43, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3188.5, 4750.91, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3266.1, 4735.58, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3364.88, 4736.82, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3364.62, 4672.27, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3087.42, 4687.38, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3159.21, 4686.48, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3214.64, 4685.77, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3270.45, 4670.81, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3090.14, 4624.34, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3156.29, 4623.5, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3218.84, 4622.71, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3270, 4622.06, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3315.38, 4590.68, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3386.65, 4591.3, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3073.7, 4575.71, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3135.71, 4574.92, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3186.4, 4574.28, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3234.96, 4576.98, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3287.83, 4544.54, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3365.42, 4543.56, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3094.19, 4529.25, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3141.5, 4528.65, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3188.84, 4528.05, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3200.28, 4478.51, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3263.69, 4478.69, 128.031), QAngle(0, 0.725098, 0)),
		CSpawnPoint(Vector(-3347.63, 4480.66, 128.031), QAngle(0, 0.725098, 0))
	}
};

array<array<CSpawnPoint@>> LockDown_SecondSpawns =
{
	{
		CSpawnPoint(Vector(-4123.22, 1388.76, 0.03125), QAngle(1.37684, 47.7347, 0)),
		CSpawnPoint(Vector(-3908.26, 1477.07, 0.03125), QAngle(1.15904, 63.9608, 0)),
		CSpawnPoint(Vector(-4018.49, 1685.58, 0.03125), QAngle(-0.365565, 13.0546, 0)),
		CSpawnPoint(Vector(-3871.53, 2116.89, 0.03125), QAngle(0.0337349, 125.598, 0)),
		CSpawnPoint(Vector(-4105.1, 2167.89, 0.03125), QAngle(5.51503, 56.2803, -0)),
		CSpawnPoint(Vector(-3615.76, 2061.52, -3.44051), QAngle(-0.292973, 58.4069, 0)),
		CSpawnPoint(Vector(-3640.63, 2252.82, -2.38427), QAngle(6.13213, 44.9389, -0)),
		CSpawnPoint(Vector(-3368.76, 2045.32, -3.05667), QAngle(5.33352, 91.9481, 0)),
		CSpawnPoint(Vector(-3381.35, 2241.89, -2.51884), QAngle(3.15552, 65.5952, -0)),
		CSpawnPoint(Vector(-3823.5, 2723.15, -0.972771), QAngle(-3.05177, 55.902, 0)),
		CSpawnPoint(Vector(-4017.6, 2753.88, 0.03125), QAngle(-0.547072, 25.6641, 0)),
		CSpawnPoint(Vector(-3900.15, 3202.68, 13.3853), QAngle(-1.01897, -70.9665, 0)),
		CSpawnPoint(Vector(-4124.75, 3063.39, -5.55648), QAngle(0.904893, -38.5504, 0)),
		CSpawnPoint(Vector(-3131.18, 3191.4, -1.66649), QAngle(-4.21339, -63.416, 0)),
		CSpawnPoint(Vector(-2906, 3201, 0.03125), QAngle(2.4295, -99.6433, 0)),
		CSpawnPoint(Vector(-2883.81, 2812.28, -4.02691), QAngle(-2.7977, -102.366, -0)),
		CSpawnPoint(Vector(-3150.62, 2194.82, -1.06011), QAngle(-5.1935, -56.5916, 0)),
		CSpawnPoint(Vector(-2862.06, 2176.51, 0.0234909), QAngle(-0.619681, -138.521, 0)),
		CSpawnPoint(Vector(-3139.59, 2288.62, -1.40147), QAngle(-4.50378, 55.443, 0)),
		CSpawnPoint(Vector(-2875.44, 2308.66, 0.03125), QAngle(-4.79418, 115.302, 0)),
		CSpawnPoint(Vector(-3311.65, 1412.96, -3.99557), QAngle(-0.220373, 139.841, 0)),
		CSpawnPoint(Vector(-3230.03, 1410.81, -4.08305), QAngle(1.73983, 37.1481, 0)),
		CSpawnPoint(Vector(-3587.19, 1846.1, 0.03125), QAngle(-0.0751748, -1.83805, 0)),
		CSpawnPoint(Vector(-3644.27, 1368.03, -4.38946), QAngle(-5.41128, 22.3016, 0)),
		CSpawnPoint(Vector(-2756.24, 1530.18, 128.031), QAngle(-0.547085, 91.1991, 0)),
		CSpawnPoint(Vector(-2768.24, 2028.25, 128.031), QAngle(0.505621, -87.7599, 0)),
		CSpawnPoint(Vector(-2763.04, 2459.14, 128.031), QAngle(0.287823, 89.1662, 0)),
		CSpawnPoint(Vector(-2769.27, 2795.87, 128.031), QAngle(2.13912, -88.4859, -0)),
		CSpawnPoint(Vector(-2639.67, 3198.86, 128.031), QAngle(3.84522, -126.65, 0)),
		CSpawnPoint(Vector(-2692.83, 2962.05, 128.031), QAngle(7.80193, 95.7003, 0)),
		CSpawnPoint(Vector(-2626.1, 3710.17, 128.031), QAngle(5.58763, -137.794, 0)),
		CSpawnPoint(Vector(-2666.38, 3318.13, 128.031), QAngle(3.73632, 82.8865, 0)),
		CSpawnPoint(Vector(-2473.79, 4071.92, 128.031), QAngle(0.46933, -144.292, 0)),
		CSpawnPoint(Vector(-2700.12, 4019.24, 128.031), QAngle(3.48224, -37.0728, 0)),
		CSpawnPoint(Vector(-2733.11, 4839.64, 128.031), QAngle(3.22814, -159.247, 0)),
		CSpawnPoint(Vector(-2715.44, 4625.81, 128.031), QAngle(2.39323, -166.943, 0)),
		CSpawnPoint(Vector(-3060.66, 5042.22, 128.031), QAngle(4.53492, -85.1223, -0)),
		CSpawnPoint(Vector(-2875.64, 5042.54, 128.031), QAngle(5.91432, -99.8239, -0)),
		CSpawnPoint(Vector(-3439.6, 4991.19, 128.031), QAngle(5.18831, -80.5986, 0)),
		CSpawnPoint(Vector(-3206.48, 4668.55, 128.031), QAngle(-0.038897, 31.3314, -0)),
		CSpawnPoint(Vector(-3202.84, 4545.11, 128.031), QAngle(0.2152, -43.4502, 0)),
		CSpawnPoint(Vector(-3339.64, 4668.7, 128.031), QAngle(6.45879, -165.273, 0)),
		CSpawnPoint(Vector(-4119.9, 4345.04, 128.031), QAngle(-1.23683, -28.712, 0)),
		CSpawnPoint(Vector(-4092.41, 4212.22, 128.031), QAngle(6.74917, 24.3948, 0)),
		CSpawnPoint(Vector(-3530.23, 4038.7, 128.031), QAngle(9.29018, 94.4668, 0)),
		CSpawnPoint(Vector(-3580.84, 4932.1, 128.031), QAngle(0.178924, -111.258, 0)),
		CSpawnPoint(Vector(-3886.62, 4889.91, 64.0313), QAngle(-6.64548, 3.08696, 0)),
		CSpawnPoint(Vector(-3762.82, 4872.94, 0.03125), QAngle(5.73279, 4.86567, 0)),
		CSpawnPoint(Vector(-4148.58, 4674.61, 0.03125), QAngle(4.42598, -43.945, 0)),
		CSpawnPoint(Vector(-3978.53, 4648.53, 0.03125), QAngle(8.96346, -122.716, 0)),
		CSpawnPoint(Vector(-3855.61, 4529.1, 0.03125), QAngle(6.34985, -37.6285, 0)),
		CSpawnPoint(Vector(-3669.92, 4007.25, 0.03125), QAngle(12.9564, 78.7855, 0)),
		CSpawnPoint(Vector(-3661.9, 4068.88, 0.03125), QAngle(-0.946479, 101.727, 0)),
		CSpawnPoint(Vector(-3556.33, 4733.08, 0.03125), QAngle(4.7889, -114.657, 0)),
		CSpawnPoint(Vector(-3605.69, 5273.54, 0.03125), QAngle(0.686998, 120.326, -0)),
		CSpawnPoint(Vector(-4069.93, 5329.13, 0.03125), QAngle(2.90129, 39.1588, 0)),
		CSpawnPoint(Vector(-3704.02, 5638.78, 0.03125), QAngle(2.79241, -27.8873, 0)),
		CSpawnPoint(Vector(-3980.53, 6135.46, 0.03125), QAngle(3.01019, -59.2505, 0)),
		CSpawnPoint(Vector(-3805.63, 5950.87, 0.03125), QAngle(4.67998, -122.884, 0)),
		CSpawnPoint(Vector(-3979.62, 5819.34, 0.03125), QAngle(5.2971, -66.4741, 0)),
		CSpawnPoint(Vector(-3126.86, 5357.96, 0.03125), QAngle(6.6039, 166.199, -0)),
		CSpawnPoint(Vector(-3294.54, 5652.52, 0.03125), QAngle(7.58401, -151.162, 0)),
		CSpawnPoint(Vector(-3408.11, 5435.69, 0.03125), QAngle(1.08631, -91.9401, 0)),
		CSpawnPoint(Vector(-3227.89, 4536.7, 0.03125), QAngle(-0.0389964, -66.582, 0)),
		CSpawnPoint(Vector(-3174.78, 4769.4, 0.03125), QAngle(6.2046, -59.4672, 0)),
		CSpawnPoint(Vector(-2760.04, 4993.13, 0.03125), QAngle(8.2737, -115.769, 0)),
		CSpawnPoint(Vector(-3228.9, 3754.02, 0.03125), QAngle(0.977388, 58.1086, 0)),
		CSpawnPoint(Vector(-3132.19, 4028.58, 0.03125), QAngle(6.45868, -67.2716, 0)),
		CSpawnPoint(Vector(-2880.14, 3995.41, 128.031), QAngle(17.1309, -99.2029, -0)),
		CSpawnPoint(Vector(-3262.16, 4054.05, 128.031), QAngle(8.31004, -1.52245, 0)),
		CSpawnPoint(Vector(-3051.67, 3609.37, 0.03125), QAngle(2.17533, -160.404, 0)),
		CSpawnPoint(Vector(-3636.79, 3437.02, 0.03125), QAngle(0.941142, 23.2143, 0)),
		CSpawnPoint(Vector(-3387.35, 2914.59, -2.26585), QAngle(0.324049, 106.717, 0))
	}
};

const int TEAM_LOBBYGUYS = 0;
int iMaxPlayers;

void OnMapInit()
{
	iMaxPlayers = Globals.GetMaxClients();
	Engine.PrecacheFile(sound, "buttons/lever8.wav");
	Entities::RegisterOutput("OnPressed", "fan_button");

	OnNewRound();
}

void OnNewRound()
{
	Schedule::Task(0.05f, "SetUpStuff");
	Schedule::Task(0.05f, "LockDown_FindCrates");
}

void OnMatchBegin()
{
	RemoveNativeSpawns("info_player_human");
	CreateSpawnsFromArray(LockDown_SecondSpawns, false);
}

void SetUpStuff()
{
	RemoveNativeSpawns("info_player_human");
	RemoveNativeSpawns("info_player_zombie");
	CreateSpawnsFromArray(LockDown_Spawns, true);
	PlayLobbyAmbient();
	Shadows();

	Engine.Ent_Fire("what_a_light", "TurnOn");
	Engine.Ent_Fire("crates", "AddOutput", "physdamagescale 0.05");
	Engine.Ent_Fire("fan_button", "AddOutput", "wait 25");
}

void LockDown_FindCrates()
{
	CBaseEntity@ pEntity = null;

	while ((@pEntity = FindEntityByClassname(pEntity, "prop_itemcrate")) !is null)
	{
		pEntity.SUB_Remove();
	}
}

void OnEntityOutput(const string &in strOutput, CBaseEntity@ pActivator, CBaseEntity@ pCaller)
{
	string strTargetname = pCaller.GetEntityName();

	if (Utils.StrEql("OnPressed", strOutput) && Utils.StrEql("fan_button", strTargetname))
	{
		Engine.EmitSoundPosition(pCaller.entindex(), "buttons/lever8.wav", pCaller.GetAbsOrigin(), 0.85f, 65, 95);
		Engine.Ent_Fire("fan_switch", "SetAnimation", "switch");
		Engine.Ent_Fire("fan_switch", "SetPlaybackRate", "1.5");
		Engine.Ent_Fire("fan_switch", "SetPlaybackRate", "0", "0.85");
		Engine.Ent_Fire("fan_enable", "Trigger", "0", "1.5");
		Engine.Ent_Fire("fan_switch", "SetAnimation", "idle", "24.85");
	}
}

void Shadows()
{
	CBaseEntity@ pShadowControl = FindEntityByClassname(pShadowControl, "shadow_control");
	if (pShadowControl !is null)
	{
		Engine.Ent_Fire_Ent(pShadowControl, "SetShadowsDisabled", "0");
	}
}